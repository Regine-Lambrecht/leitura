<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aprendendo com o Pedro (Demo)</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        /* Estilos CSS (style.css incorporé) */
        :root {
            --cor-principal: #3498db; /* BLEU */
            --cor-fundo: #ecf0f1;
            --cor-sucesso: #2ecc71; /* VERT (Succès/Bravo) */
            --cor-erreur: #e74c3c;
            --cor-voltar: #3498db; /* BLEU pour Voltar */
            --cor-reset: #e74c3c;
            --tamanho-letra: 24px;
        }

        body {
            font-family: 'Times New Roman', Times, serif;
            background-color: var(--cor-fundo);
            color: #333;
            margin: 0;
            padding: 20px;
            text-align: center;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            background: #fff;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            position: relative;
        }

        h1, h2 {
            font-family: 'Times New Roman', Times, serif;
            color: var(--cor-principal);
            margin-bottom: 20px;
        }

        /* Seção de Pontuação et Messages */
        #score-container {
            margin-bottom: 20px;
            padding: 10px;
            border: 2px solid var(--cor-principal);
            border-radius: 10px;
        }

        #progresso-msg {
            font-weight: bold;
            color: var(--cor-sucesso);
            margin-top: 10px;
        }

        /* Boutons de Niveau */
        .nivel-btn {
            display: flex;
            align-items: center;
            justify-content: space-between; /* ALIGNEMENT SPÉCIFIQUE POUR POUSSER L'ICÔNE À DROITE */
            width: 100%;
            padding: 15px;
            margin: 10px 0;
            font-size: 1.2em;
            color: #fff;
            background-color: var(--cor-principal);
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: background-color 0.3s;
            font-family: 'Times New Roman', Times, serif;
        }

        .nivel-btn span {
            display: flex; /* Conteneur pour le texte et les icônes */
            align-items: center;
        }

        /* Voltar est BLEU */
        .nivel-btn.voltar-btn {
            background-color: var(--cor-voltar);
            justify-content: center; /* Centrer le contenu du bouton Voltar */
        }

        .nivel-btn.voltar-btn:hover {
            background-color: #2980b9;
        }

        .nivel-btn:hover:not(:disabled) {
            background-color: #2980b9;
        }

        .nivel-btn:disabled {
            background-color: #bdc3c7;
            cursor: not-allowed;
            color: #7f8c8d;
        }

        /* Conteneur pour les icônes à droite du terme */
        .icon-container {
            margin-left: 10px; /* Espace entre le terme et les icônes */
            display: flex;
            align-items: center;
        }
        .icon-container i {
            margin-right: 2px; /* Espacement entre icônes multiples */
            font-size: 1.5em;
        }

        .contador-progresso {
            font-size: 0.8em;
            background: rgba(255, 255, 255, 0.2);
            padding: 2px 8px;
            border-radius: 5px;
            /* Le compteur est naturellement à droite grâce à justify-content: space-between sur .nivel-btn */
        }

        /* Bouton Recomeçar de zero */
        #btn-reset {
            background-color: var(--cor-reset);
            color: white;
            margin-top: 20px;
            padding: 10px;
            font-size: 1em;
            font-family: 'Times New Roman', Times, serif;
            justify-content: center;
        }

        #btn-reset:hover {
            background-color: #c0392b;
        }

        /* Visibilidade des Telas */
        .tela-jogo {
            display: none;
            padding-top: 20px;
        }

        /* Nível 1: Damier */
        #letras-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .letra-quadro {
            height: 80px;
            background-color: #f1c40f;
            color: #333;
            font-size: var(--tamanho-letra);
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            cursor: pointer;
            user-select: none;
            transition: background-color 0.2s, transform 0.1s;
        }

        .letra-quadro.selecionada {
            background-color: #e67e22;
            transform: scale(0.98);
        }

        .letra-quadro.correta {
            background-color: var(--cor-sucesso);
            color: white;
            pointer-events: none;
        }

        .btn-cancelar {
            padding: 10px 20px;
            background-color: var(--cor-erreur);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        /* Nível 2: Opções de Sílabas (horizontal) */
        #opcoes-silabas {
            display: flex;
            justify-content: space-around;
            gap: 10px;
        }

        /* Styles pour les boutons de réponse dans les niveaux 2, 3 et 4 */
        .opcao-btn, .btn-verdadeiro-falso {
            padding: 15px;
            margin: 10px 0;
            font-size: 1.2em;
            border: 2px solid var(--cor-principal);
            background-color: white;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s;
            font-family: 'Times New Roman', Times, serif;
        }

        /* Feedback Nível 4 */
        .btn-verdadeiro-falso.feedback-correto {
            background-color: var(--cor-sucesso);
            color: white;
            border-color: var(--cor-sucesso);
        }
        .btn-verdadeiro-falso.feedback-incorreto {
            background-color: var(--cor-erreur);
            color: white;
            border-color: var(--cor-erreur);
        }

        /* Nível 3: Options de réponse (plus d'espace) */
        #opcoes-palavras .opcao-btn {
            margin: 15px 0;
        }

        #opcoes-silabas .opcao-btn {
            flex-grow: 1;
            font-size: 1.5em;
        }

        .opcao-btn:hover, .btn-verdadeiro-falso:hover {
            background-color: #eee;
        }

        /* Nível 3: Bouton Escutar (plus petit, aligné) */
        .btn-audio {
            width: auto;
            padding: 10px 20px;
            background-color: var(--cor-principal);
            color: white;
            border: none;
            border-radius: 8px;
            margin: 10px auto 25px auto;
            display: block;
            cursor: pointer;
            font-size: 1.1em;
            font-family: 'Times New Roman', Times, serif;
        }

        .btn-audio i {
            margin: 0;
            font-size: 1.4em;
        }

        /* Message Bravo et Overlay */
        #overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            z-index: 999;
            display: none;
        }

        #mensagem-bravo {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: var(--cor-sucesso);
            color: white;
            padding: 30px 50px;
            border-radius: 20px;
            border: 5px solid white;
            font-size: 2em;
            font-weight: bold;
            z-index: 1000;
            display: none;
            animation: fadeIn 0.3s;
        }

        /* Modal de Confirmação */
        #modal-confirmacao {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            color: #333;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            z-index: 1001;
            width: 80%;
            max-width: 350px;
        }

        #modal-confirmacao p {
            font-size: 1.1em;
            margin-bottom: 20px;
        }

        .botoes-modal {
            display: flex;
            justify-content: space-between;
            gap: 10px;
        }

        .botoes-modal button {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            font-weight: bold;
            cursor: pointer;
            width: 50%;
            font-family: 'Times New Roman', Times, serif;
        }

        #btn-sim {
            background-color: var(--cor-reset);
            color: white;
        }

        #btn-nao {
            background-color: var(--cor-voltar);
            color: white;
        }


        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
    </style>
</head>
<body>

<div id="overlay"></div>

<div id="modal-confirmacao" style="display: none;">
    <p>Você vai perder todos os pontos. Quer mesmo recomeçar?</p>
    <div class="botoes-modal">
        <button id="btn-sim" onclick="confirmaRecomeco()">Sim</button>
        <button id="btn-nao" onclick="cancelaRecomeco()">Não</button>
    </div>
</div>

<div class="container">
    <div id="tela-home" class="tela-jogo" style="display: block;">
        <h1>Oi Pedro ! Vamos estudar !</h1>

        <div id="score-container">
            <p>Pontuação Global: <span id="score-valor">0</span> pontos</p>
            <p id="progresso-msg"></p>
        </div>

        <button class="nivel-btn" id="btn-nivel-1" onclick="iniciarNivel(1)">
            <span class="content-left-group">Letras <span class="icon-container"><i class="fa-solid fa-trophy"></i></span></span>
            <span class="contador-progresso" id="count-n1"></span>
        </button>
        
        <button class="nivel-btn" id="btn-nivel-2" onclick="iniciarNivel(2)" disabled>
            <span class="content-left-group">Sílabas <span class="icon-container"><i class="fa-solid fa-trophy"></i><i class="fa-solid fa-trophy"></i></span></span>
            <span class="contador-progresso" id="count-n2"></span>
        </button>
        <button class="nivel-btn" id="btn-nivel-3" onclick="iniciarNivel(3)" disabled>
            <span class="content-left-group">Palavras <span class="icon-container"><i class="fa-solid fa-medal"></i></span></span>
            <span class="contador-progresso" id="count-n3"></span>
        </button>
        <button class="nivel-btn" id="btn-nivel-4" onclick="iniciarNivel(4)" disabled>
            <span class="content-left-group">Frases <span class="icon-container"><i class="fa-solid fa-user-graduate"></i></span></span>
            <span class="contador-progresso" id="count-n4"></span>
        </button>

        <button class="nivel-btn" id="btn-reset" onclick="recomecarDeZero()">
            <i class="fa-solid fa-sync-alt"></i> Recomeçar de zero
        </button>
    </div>

    <div id="tela-nivel-1" class="tela-jogo">
        <h2>Letras (Pares)</h2>
        <p>Encontre os 6 pares (Maiúscula e minúscula).</p>
        <div id="letras-grid"></div>
        <button class="btn-cancelar" onclick="cancelarSelecaoNivel1()">Cancelar</button>
        <button class="nivel-btn voltar-btn" onclick="mostrarTela('home')">Voltar</button>
    </div>


    <div id="tela-nivel-2" class="tela-jogo">
        <h2>Sílabas</h2>
        <p>Qual é a sílaba **<span id="silaba-maiuscula" style="color: var(--cor-principal);"></span>** em minúsculas?</p>
        <div id="opcoes-silabas"></div>
        <button class="nivel-btn voltar-btn" onclick="mostrarTela('home')">Voltar</button>
    </div>

    <div id="tela-nivel-3" class="tela-jogo">
        <h2>Palavras</h2>
        <p>Escute a palavra e a encontre entre les options.</p>
        <button class="btn-audio" onclick="falarPalavraAtual()"><i class="fa-solid fa-volume-up"></i></button>
        <div id="opcoes-palavras"></div>
        <button class="nivel-btn voltar-btn" onclick="mostrarTela('home')">Voltar</button>
    </div>

    <div id="tela-nivel-4" class="tela-jogo">
        <h2>Frases</h2>
        <div id="frase-pergunta-container">
            <p id="frase-pergunta" style="font-size: 1.2em; margin: 0;"></p>
        </div>
        <button class="btn-verdadeiro-falso" onclick="responderFrase('Verdadeiro', this)">Verdadeiro</button>
        <button class="btn-verdadeiro-falso" onclick="responderFrase('Falso', this)">Falso</button>
        <button class="nivel-btn voltar-btn" onclick="mostrarTela('home')">Voltar</button>
    </div>

    <div id="mensagem-bravo" style="display:none;">Bravo Pedro!</div>

</div>

<script>
    // Configuração das vozes TTS
    const synth = window.speechSynthesis;
    let brazilVoice = null;

    function setupVoice() {
        const voices = synth.getVoices();
        brazilVoice = voices.find(voice => voice.lang === 'pt-BR') || voices[0];
    }

    if (synth.onvoiceschanged !== undefined) {
        synth.onvoiceschanged = setupVoice;
    } else {
        setupVoice();
    }

    function falarTexto(texto) {
        if (synth.speaking) {
            synth.cancel();
        }
        const utterance = new SpeechSynthesisUtterance(texto);
        utterance.lang = 'pt-BR';
        utterance.rate = 0.8;
        if (brazilVoice) {
            utterance.voice = brazilVoice;
        }
        synth.speak(utterance);
    }

    // --- DADOS DU JEU ---

    const DADOS_LETRAS = [
        ['A', 'a', 'E', 'e', 'I', 'i', 'O', 'o', 'U', 'u', 'Y', 'y'],
        ['B', 'b', 'D', 'd', 'P', 'p', 'Q', 'q', 'R', 'r', 'V', 'v'],
        ['C', 'c', 'F', 'f', 'G', 'g', 'H', 'h', 'J', 'j', 'T', 't'],
        ['K', 'k', 'L', 'l', 'M', 'm', 'N', 'n', 'S', 's', 'X', 'x']
    ];

    let PALAVRAS = []; // Sera rempli par fetch

    const DEFINITIONS = {
        // --- START OF DEFINITION LIST (78 PALAVRAS) ---
        'abelha': "Um inseto que produz mel e vive em grandes colmeias.",
        'arara': "Um pássaro tropical grande e colorido, conhecido por sua cauda longa.",
        'baleia': "O maior animal do planeta, um mamífero que vive nos oceanos.",
        'banana': "Uma fruta amarela e alongada, macia e doce, que cresce em cachos.",
        'barata': "Um inseto noturno, de cor escura, que vive em lugares úmidos e sujos.",
        'boca': "A abertura por onde a comida e a fala entram e saem do corpo.",
        'bola': "Um objeto esférico usado para diversos jogos e esportes.",
        'bolacha': "Um biscoito, um doce seco e plano, geralmente feito de farinha e açúcar.",
        'boliche': "Um esporte de arremesso que derruba dez pinos com uma bola pesada.",
        'bolo': "Uma massa doce, assada no forno, feita com farinha, ovos e açúcar.",
        'braço': "A parte do corpo humano que se estende do ombro até a mão.",
        'brasil': "O maior país da América do Sul, famoso pelo samba e floresta amazônica.",
        'cabide': "Um objeto com gancho, usado para pendurar roupas em armários.",
        'cabine': "Um compartimento fechado em um avião, navio ou elevador.",
        'cachorro': "Um mamífero doméstico, conhecido por sua lealdade e latidos.",
        'cama': "Um móvel com colchão onde as pessoas se deitam para dormir.",
        'caneta': "Um instrumento usado para escrever ou desenhar, usando tinta.",
        'casa': "Uma construção onde as pessoas moram e se abrigam.",
        'casada': "Uma mulher que está unida a outra pessoa por meio de um casamento.",
        'chapéu': "Uma peça de vestuário usada para cobrir a cabeça.",
        'chave': "Um pequeno objeto de metal que aciona fechaduras e ignições.",
        'chiclete': "Uma goma de mascar doce e elástica, feita para ser mastigada.",
        'chupeta': "Um objeto de borracha que se dá a bebês para chupar.",
        'chuva': "Água que cai das nuvens em forma de gotas.",
        'cobra': "Um réptil longo e rastejante, muitas vezes venenoso.",
        'coelho': "Um mamífero pequeno, com orelhas longas e que adora cenouras.",
        'cofre': "Uma caixa metálica e forte, usada para guardar dinheiro e objetos de valor.",
        'diploma': "Um certificado que comprova a conclusão de um curso ou estudo.",
        'domingão': "O último dia da semana, geralmente dedicado ao descanso e lazer.",
        'festejar': "Comemorar ou celebrar algo com alegria e animação.",
        'faca': "Um utensílio com lâmina afiada, usado para cortar alimentos.",
        'fica': "O ato de permanecer ou continuar em um determinado lugar.",
        'fita': "Uma tira fina de tecido ou plástico, usada para amarrar ou decorar.",
        'foca': "Um mamífero marinho com corpo alongado, que vive em regiões frias.",
        'foguete': "Um veículo espacial que usa propulsão para ir para o espaço sideral.",
        'galinha': "Uma ave doméstica, criada para fornecer carne e ovos.",
        'gato': "Um felino doméstico, conhecido por miar e por sua agilidade.",
        'golfinho': "Um mamífero marinho inteligente, conhecido por saltar na água.",
        'invejar': "Desejar ter o que pertence ou é de outra pessoa.",
        'jabuti': "Um réptil terrestre, parecido com a tartaruga, com casco duro.",
        'lábio': "A parte carnuda e móvel que contorna a boca.",
        'lápis': "Um instrumento fino de madeira e grafite, usado para escrever ou desenhar.",
        'leão': "Um grande felino, conhecido como o rei da selva por sua força e juba.",
        'letra': "Cada sinal gráfico que forma o alfabeto e representa um som.",
        'lixo': "Restos e materiais descartados que precisam ser jogados fora.",
        'livro': "Um conjunto de páginas encadernadas, contendo textos ou imagens.",
        'maçã': "Uma fruta redonda e crocante, geralmente vermelha ou verde.",
        'macaco': "Um primata com cauda e braços longos, conhecido por subir em árvores.",
        'neto': "O filho da filha ou do filho de uma pessoa.",
        'onça': "Um grande felino predador, com pele pintada, típico da América do Sul.",
        'pato': "Uma ave aquática, com pescoço curto e bico largo, que nada e voa.",
        'peito': "A parte superior e frontal do tronco do corpo humano.",
        'peixe': "Um animal aquático com brânquias e barbatanas, que vive em rios ou mares.",
        'peteca': "Um brinquedo com penas na base, jogado com as mãos por cima de uma rede.",
        'planejar': "Organizar ou estabelecer um conjunto de ações para atingir um objetivo.",
        'planilha': "Um documento eletrônico com linhas e colunas, usado para cálculos e dados.",
        'porco': "Um mamífero criado em fazendas para o consumo de sua carne.",
        'porta': "Uma barreira móvel que permite a entrada e saída de um cômodo.",
        'prato': "Um utensílio de mesa, geralmente redondo e raso, usado para servir a comida.",
        'professor': "Uma pessoa que ensina alunos em escolas ou universidades.",
        'sacada': "Uma varanda ou terraço que se projeta para fora do prédio.",
        'salada': "Uma mistura de folhas, legumes e verduras, geralmente servida fria.",
        'sapato': "Um calçado que cobre o pé, usado para proteger e andar.",
        'sapo': "Um anfíbio que pula e vive perto de água, conhecido por coaxar.",
        'sorriso': "Uma expressão facial de felicidade, feita com a boca.",
        'sorvete': "Uma sobremesa gelada, doce e cremosa, feita de leite e açúcar.",
        'tapete': "Um tecido grosso, usado no chão para decorar ou aquecer.",
        'tato': "O sentido que permite sentir a textura e a temperatura das coisas através da pele.",
        'tatu': "Um mamífero com o corpo coberto por uma carapaça dura e articulada.",
        'telhado': "A estrutura superior da casa que a protege da chuva e do sol.",
        'teto': "A parte interna superior de um cômodo ou construção.",
        'tomada': "Um ponto na parede onde se conecta o plugue de aparelhos elétricos.",
        'urubu': "Uma ave de rapina grande e preta, conhecida por se alimentar de carcaças.",
    };

    /**
     * Corrected Portuguese syllabification logic.
     */
    function getSilabas(palavra) {
        // Base words with non-standard splits, used as failsafe (kept from original logic)
        switch(palavra) {
            case 'chupeta': return ['chu', 'pe', 'ta'];
            case 'carro': return ['car', 'ro']; // Example of RR split
            case 'tomate': return ['to', 'ma', 'te'];
        }
        
        // This is a simplified rule-based syllabification for European/Brazilian Portuguese.
        // 1. Split double consonants (RR, SS) and complex groups (CS, CT, GN, etc.)
        // 2. Consonants usually stick with the following vowel (CV-CV rule)
        // 3. Digraphs (CH, LH, NH, QU, GU) stick together (treated as single C)
        
        let processedPalavra = palavra;
        
        // Split double letters that must be separated (RR, SS)
        processedPalavra = processedPalavra.replace(/([r|s])\1/g, '$1-$1'); // RR/SS split: car-ro, pas-sar
        
        // Split complex consonant groups that must be separated: (VC-CV)
        // Examples: At-le-ta, Ri-tmo, Ad-mi-rar
        processedPalavra = processedPalavra.replace(/([bcdfghjklmnpqrstvwxyzç])([c|t|p|g|f|v])([l|r])/g, '$1-$2$3'); 
        
        // Separate consonants that must break between vowels (intervocalic single C)
        // Find Vowel + Consonant + Vowel, and place the break BEFORE the consonant (V-CV)
        // This handles "ba-ra-ta" where Vowel (a) + Consonant (r) + Vowel (a) -> a-ra.
        // It's not perfect for all edge cases (diphthongs, trigraphs, complex clusters), 
        // but it fixes the most common issues like "barata" -> "ba-ra-ta".
        processedPalavra = processedPalavra.replace(/([aeiouyãõéêáíóú])([bcdfghjklmnpqrstvwxyzç])([aeiouyãõéêáíóú])/gi, '$1-$2$3'); 
        
        // Basic split by the introduced hyphen
        let silabas = processedPalavra.split('-');
        
        // Final cleaning: remove empty strings and merge remaining groups if needed
        silabas = silabas.filter(s => s.length > 0);
        
        // Re-merge simple two-letter words/syllables that might have been incorrectly split if needed
        // (This step is sometimes necessary depending on the regex complexity, but for simplicity, 
        // we trust the current hyphenation process is better than the original one).

        if (silabas.length === 0) return [palavra]; // Failsafe
        
        return silabas;
    }


    /**
    * RECODED: Retrieves the true definition and generates a false statement 
    * using a definition from a random, different word.
    */
    function getOrGenerateDefinition(word) {
        const trueDefinition = DEFINITIONS[word];
        
        if (!trueDefinition) {
             // Fallback if the definition is missing
             return {
                 verdadeiro: `A definição de ${word} está faltando no banco de dados.`,
                 falso: `Um(a) ${word} é um tipo de coisa que voa no céu.`
             };
        }
        
        // 1. Get a list of all defined words (keys)
        const allWords = Object.keys(DEFINITIONS);
        
        // 2. Filter out the current word 
        const distractorCandidates = allWords.filter(w => w !== word && DEFINITIONS[w]);
        
        // 3. Select a random distractor word
        let distractorWord = word;
        if (distractorCandidates.length > 0) {
            const randomIndex = Math.floor(Math.random() * distractorCandidates.length);
            distractorWord = distractorCandidates[randomIndex];
        }
        
        // 4. Create the False statement using the definition of the distractor word
        const distractorDefinition = DEFINITIONS[distractorWord];
        
        let falseStatement;
        if (distractorWord === word) {
            // Failsafe: if no distractor was found (only happens if the list is too short/empty)
            falseStatement = `A afirmação para ${word} é falsa, mas a definição de distração não foi encontrada.`; 
        } else {
            // Construct the False statement: "A [current word] is in fact [distractor definition]"
            let formattedDistractor = distractorDefinition.toLowerCase();
            if (formattedDistractor.startsWith('um ') || formattedDistractor.startsWith('uma ') || formattedDistractor.startsWith('é ')) {
                formattedDistractor = formattedDistractor.substring(formattedDistractor.indexOf(' ') + 1);
            }
            // Use 'é na verdade' for smooth transition
            falseStatement = `Um(a) ${word} é na verdade ${formattedDistractor}.`;
        }

        return {
            verdadeiro: trueDefinition,
            falso: falseStatement
        };
    }


    function calcularTotalMaximo() {
        const totalSilabas = PALAVRAS.flatMap(p => getSilabas(p)).length;
        const totalFrases = PALAVRAS.length;
        return 4 + totalSilabas + PALAVRAS.length + totalFrases;
    }

    // Fonction pour charger les mots depuis Palavras.txt (via URL GitHub)
    async function fetchWords() {
        const URL = 'https://regine-lambrecht.github.io/leitura/Palavras.txt';
        try {
            const response = await fetch(URL);
            if (!response.ok) {
                // Tente charger localement (pour le mode local)
                const responseLocal = await fetch('Palavras.txt');
                if (!responseLocal.ok) {
                    throw new Error(`Fichiers non trouvés (URL distante: ${response.status}, Local: ${responseLocal.status})`);
                }
                const text = await responseLocal.text();
                PALAVRAS = text.trim().split('\n').map(word => word.trim().toLowerCase()).filter(word => word.length > 0);
                return;
            }
            const text = await response.text();
            PALAVRAS = text.trim().split('\n').map(word => word.trim().toLowerCase()).filter(word => word.length > 0);

        } catch (error) {
            console.error("Erreur critique de chargement des mots. Le jeu ne peut pas démarrer.", error);
        }
    }

    // --- Variables d'État Global ---

    const INITIAL_GAME_STATE = {
        scoreGlobal: 0,
        progressoNivel1: [0, 0, 0, 0], 
        damierAtual: 0,                
        selecaoN1: [],                 
        syllabesUniquesCompletes: {},
        palavrasAtivasN3: {},
        palavrasCompletasN3: {},
        frasesAtivasN4: {},
        frasesCompletasN4: {}
    };

    let estadoJogo = {...INITIAL_GAME_STATE};

    let palavraAtual = '';
    let fraseAtual = null;
    let paresCorretosN1 = 0;
    let motActuelN2 = '';
    let palavraAnteriorN3 = null; // <-- NEW: Stores the last word played in N3

    // --- FUNÇÕES DE UTILIDADE ET PERSISTENCE ---

    function carregarEstado() {
        const estadoSalvo = localStorage.getItem('aprendendoComPedro');
        if (estadoSalvo) {
            estadoJogo = JSON.parse(estadoSalvo);
        } else {
            estadoJogo = {...INITIAL_GAME_STATE};
        }
    }

    function salvarEstado() {
        localStorage.setItem('aprendendoComPedro', JSON.stringify(estadoJogo));
    }

    function recomecarDeZero() {
        document.getElementById('overlay').style.display = 'block';
        document.getElementById('modal-confirmacao').style.display = 'block';
    }

    function cancelaRecomeco() {
        document.getElementById('overlay').style.display = 'none';
        document.getElementById('modal-confirmacao').style.display = 'none';
    }

    function confirmaRecomeco() {
        cancelaRecomeco();

        estadoJogo = {...INITIAL_GAME_STATE};
        motActuelN2 = '';
        palavraAnteriorN3 = null; // Reset N3 previous word
        localStorage.removeItem('aprendendoComPedro');

        atualizarInterfaceHome();
        mostrarTela('home');
    }


    function mostrarTela(id) {
        document.querySelectorAll('.tela-jogo').forEach(tela => tela.style.display = 'none');
        document.getElementById(`tela-${id}`).style.display = 'block';
        if (id === 'home') {
            atualizarInterfaceHome();
        }
    }

    function exibirMensagemBravo(callback) {
        const msgElement = document.getElementById('mensagem-bravo');
        const overlayElement = document.getElementById('overlay');

        document.getElementById('modal-confirmacao').style.display = 'none';

        overlayElement.style.display = 'block';
        msgElement.style.display = 'block';

        setTimeout(() => {
            msgElement.style.display = 'none';
            overlayElement.style.display = 'none';
            if (callback) callback();
        }, 3000);
    }

    // --- LÓGICA DU SCORE ET PROGRESSION ---

    function atualizarInterfaceHome() {
        // VÉRIFIE SI LES MOTS ONT ÉTÉ CHARGÉS AVANT DE CALCULER LES COMPTEURS
        if (PALAVRAS.length === 0) {
             document.querySelector('.container').innerHTML =
                "<h1>Erro de Carregamento</h1><p>Não foi possível carregar o arquivo <b>Palavras.txt</b> (ou ele está vazio). O jogo não pode iniciar.</p>";
             return;
        }

        document.getElementById('score-valor').textContent = estadoJogo.scoreGlobal;
        verificarMensagemProgresso(estadoJogo.scoreGlobal);
        atualizarBotoesNivel();
        salvarEstado();
    }

    function adicionarPonto(type) {
        estadoJogo.scoreGlobal += 1;
        atualizarInterfaceHome();
    }

    function atualizarBotoesNivel() {
        const damierComplet = estadoJogo.progressoNivel1.filter(c => c >= 2).length;
        const totalPalavras = PALAVRAS.length;
        const motsActifsN3 = Object.keys(estadoJogo.palavrasAtivasN3).length;
        const phrasesActivesN4 = Object.keys(estadoJogo.frasesAtivasN4).length;

        const btnN1 = document.getElementById('btn-nivel-1');
        const btnN2 = document.getElementById('btn-nivel-2');
        const btnN3 = document.getElementById('btn-nivel-3');
        const btnN4 = document.getElementById('btn-nivel-4');

        // --- NIVEAU 1 (Letras) ---
        document.getElementById('count-n1').textContent = `(${damierComplet}/${DADOS_LETRAS.length})`;
        btnN1.disabled = (damierComplet === DADOS_LETRAS.length);
        btnN2.disabled = (damierComplet < DADOS_LETRAS.length); 


        // --- NIVEAU 2 (Sílabas) ---
        let toutesSilabesUniques = [...new Set(PALAVRAS.flatMap(getSilabas))].length;
        let syllabesCompletesUniques = 0;
        Object.keys(estadoJogo.syllabesUniquesCompletes).forEach(syllabe => {
            if (estadoJogo.syllabesUniquesCompletes[syllabe] >= 2) {
                syllabesCompletesUniques++;
            }
        });
        const motsRestantsN2 = totalPalavras - motsActifsN3;
        btnN2.querySelector('.contador-progresso').textContent = `(${syllabesCompletesUniques}/${toutesSilabesUniques})`;


        // --- NIVEAU 3 (Palavras) ---
        const motsCompletsN3x2 = Object.keys(estadoJogo.palavrasAtivasN3).filter(p => (estadoJogo.palavrasCompletasN3[p] || 0) >= 2).length;
        const denominateurN3 = motsActifsN3;
        const displayDenominateurN3 = denominateurN3 === 0 ? 0 : denominateurN3;

        btnN3.disabled = (motsActifsN3 === 0) || (motsActifsN3 > 0 && motsCompletsN3x2 === motsActifsN3);
        btnN3.querySelector('.contador-progresso').textContent = `(${motsCompletsN3x2}/${displayDenominateurN3})`;

        // --- NIVEAU 4 (Frases) ---
        const phrasesCompletsN4x2 = Object.keys(estadoJogo.frasesAtivasN4).filter(p => (estadoJogo.frasesCompletasN4[p] || 0) >= 2).length;
        const denominateurN4 = phrasesActivesN4;
        const displayDenominateurN4 = denominateurN4 === 0 ? 0 : denominateurN4;

        btnN4.disabled = (phrasesActivesN4 === 0) || (phrasesActivesN4 > 0 && phrasesCompletsN4x2 === phrasesActivesN4);
        btnN4.querySelector('.contador-progresso').textContent = `(${phrasesCompletsN4x2}/${displayDenominateurN4})`;
    }


    function verificarMensagemProgresso(score) {
        const totalMaximo = calcularTotalMaximo();
        const ratio = score / totalMaximo;
        let message = "";

        if (ratio >= 2/3) {
            message = "Você está arrasando !";
        } else if (ratio >= 0.5) {
            message = "Você está ótimo !";
        } else if (ratio >= 1/3) {
            message = "Você está indo muito bem !";
        }

        if (score >= totalMaximo) {
            message = "Você é top !";
        }
        document.getElementById('progresso-msg').textContent = message;
    }

    // --- NÍVEL 1: LETRAS ---

    function iniciarNivel(nivel) {
        if (PALAVRAS.length === 0) {
             document.querySelector('.container').innerHTML =
                "<h1>Erro</h1><p>Não foi possível iniciar o nível. O jogo não carregou as palavras.</p>";
             return;
        }

        mostrarTela(`nivel-${nivel}`);
        switch (nivel) {
            case 1: iniciarNivel1(); break;
            case 2: iniciarNivel2(); break;
            case 3: iniciarNivel3(); break;
            case 4: iniciarNivel4(); break;
        }
    }

    // FINAL RECODED: Lógica de inicialização do Nível 1 - SIMPLE SEQUENTIAL
    function iniciarNivel1() {
        paresCorretosN1 = 0;
        estadoJogo.selecaoN1 = [];

        // 1. Check if all sets are completed (4/4) -> Redirect to Home
        if (estadoJogo.progressoNivel1.filter(c => c >= 2).length === DADOS_LETRAS.length) {
            mostrarTela('home');
            return;
        }
        
        // 2. Determine the set index to load
        let indexToLoad = estadoJogo.damierAtual % DADOS_LETRAS.length;
        
        // Failsafe: if the current index is complete, find the next sequential incomplete one.
        let startCheck = indexToLoad;
        while (estadoJogo.progressoNivel1[indexToLoad] >= 2) {
             indexToLoad = (indexToLoad + 1) % DADOS_LETRAS.length;
             if (indexToLoad === startCheck) { 
                mostrarTela('home'); return; 
             }
        }
        
        estadoJogo.damierAtual = indexToLoad;
        
        const damier = DADOS_LETRAS[estadoJogo.damierAtual];
        const melange = [...damier].sort(() => Math.random() - 0.5);

        const grid = document.getElementById('letras-grid');
        grid.innerHTML = '';

        melange.forEach(letra => {
            const caseElement = document.createElement('div');
            caseElement.textContent = letra;
            caseElement.className = 'letra-quadro';
            caseElement.dataset.letra = letra;
            caseElement.onclick = () => selecionarLetra(caseElement);
            grid.appendChild(caseElement);
        });
    }

    function selecionarLetra(element) {
        if (element.classList.contains('correta') || estadoJogo.selecaoN1.length >= 2) return;

        if (estadoJogo.selecaoN1.includes(element)) return;

        element.classList.add('selecionada');
        estadoJogo.selecaoN1.push(element);

        if (estadoJogo.selecaoN1.length === 2) {
            verificarPares();
        }
    }

    function cancelarSelecaoNivel1() {
        if (estadoJogo.selecaoN1.length >= 1) {
            const lastElement = estadoJogo.selecaoN1.pop();
            if (lastElement) {
                lastElement.classList.remove('selecionada');
            }
        }
    }

    function verificarPares() {
        const [elem1, elem2] = estadoJogo.selecaoN1;
        const l1 = elem1.dataset.letra;
        const l2 = elem2.dataset.letra;
        const isPair = (l1.toLowerCase() === l2.toLowerCase()) && (l1 !== l2);

        if (isPair) {
            paresCorretosN1++;

            elem1.classList.add('correta');
            elem2.classList.add('correta');
            elem1.classList.remove('selecionada');
            elem2.classList.remove('selecionada');

            if (paresCorretosN1 === 6) {
                sucessoNivel1();
            }
        } else {
            setTimeout(() => {
                elem1.classList.remove('selecionada');
                elem2.classList.remove('selecionada');
            }, 1000);
        }
        estadoJogo.selecaoN1 = [];
        salvarEstado();
    }

    // NEW CODE: Lógica de sucesso do Nível 1 (Immediate Sequential Advance)
    function sucessoNivel1() {
        const currentCount = estadoJogo.progressoNivel1[estadoJogo.damierAtual];
        const currentDamierIndex = estadoJogo.damierAtual;

        // 1. Increment the count for the current damier
        estadoJogo.progressoNivel1[currentDamierIndex]++;

        // 2. Check if this was the SECOND completion (to award the point)
        const didJustCompleteTwice = (currentCount === 1) && (estadoJogo.progressoNivel1[currentDamierIndex] === 2);
        
        // 3. Advance the pointer to the NEXT SEQUENTIAL damier (D+1 -> D2, D4 -> D1)
        estadoJogo.damierAtual = (currentDamierIndex + 1) % DADOS_LETRAS.length;

        if (didJustCompleteTwice) {
            // Second solve: Award point.
            adicionarPonto('letra');
        } 
        
        // Immediately load the next challenge, or go home if complete.
        if (estadoJogo.progressoNivel1.filter(c => c >= 2).length === DADOS_LETRAS.length) {
            mostrarTela('home'); 
        } else {
            iniciarNivel1();
        }
        
        salvarEstado();
    }

    // --- NÍVEL 2: SÍLABAS ---

    function generateDistractors(correct) {
        const correctLower = correct.toLowerCase();
        let distractors = [];
        const alphabet = 'bcdefghijklmnpqrstvwxyz';

        for (let i = 0; i < correctLower.length; i++) {
            const originalChar = correctLower[i];
            const randomChar = alphabet[Math.floor(Math.random() * alphabet.length)];

            if (!'aeiouãõ'.includes(originalChar) && randomChar !== originalChar) {
                const distractor = correctLower.substring(0, i) + randomChar + correctLower.substring(i + 1);
                if (distractor !== correctLower && !distractors.includes(distractor) && distractors.length < 2) {
                    distractors.push(distractor);
                }
            }
        }
        while (distractors.length < 2) {
            let uniqueDistractor = correctLower.substring(0, correctLower.length - 1) + alphabet[Math.floor(Math.random() * alphabet.length)] + (correctLower.length > 2 ? 'a' : '');
            if (!distractors.includes(uniqueDistractor) && uniqueDistractor.length >= 2) {
                 distractors.push(uniqueDistractor);
            } else if (distractors.length === 0) {
                distractors.push('tepo');
            }
        }
        return distractors.slice(0, 2);
    }

    let silabasParaJogar = [];
    let silabaAtual = '';

    function iniciarNivel2() {
        let silabasRestantesDoMotAtual = [];
        if (motActuelN2) {
            const silabasDoMot = getSilabas(motActuelN2);
            // Vérifie si TOUTES les syllabes du word actuel ont été complétées 2x (via le compteur global)
            const motComplete = silabasDoMot.every(s => (estadoJogo.syllabesUniquesCompletes[s.toLowerCase()] || 0) >= 2);

            if (motComplete) {
                motActuelN2 = '';
            } else {
                // Filtre les syllabes du word actuel qui n'ont pas encore 2 réussites
                silabasRestantesDoMotAtual = silabasDoMot.filter(s => (estadoJogo.syllabesUniquesCompletes[s.toLowerCase()] || 0) < 2);
            }
        }

        if (!motActuelN2) {
            // Filter words for Level 2: only those that have at least one unique syllable
            // not yet completed (count < 2)
            const motsNonActives = PALAVRAS.filter(p => {
                const silabas = getSilabas(p);
                return silabas.some(silaba => {
                    return (estadoJogo.syllabesUniquesCompletes[silaba.toLowerCase()] || 0) < 2;
                });
            });

            if (motsNonActives.length === 0) {
                mostrarTela('home');
                return;
            }

            motActuelN2 = motsNonActives[Math.floor(Math.random() * motsNonActives.length)];

            const silabasDoMot = getSilabas(motActuelN2);
            silabasRestantesDoMotAtual = silabasDoMot.filter(s => (estadoJogo.syllabesUniquesCompletes[s.toLowerCase()] || 0) < 2);
        }

        palavraAtual = motActuelN2;
        silabasParaJogar = silabasRestantesDoMotAtual;

        if (silabasParaJogar.length === 0) {
             motActuelN2 = '';
             iniciarNivel2();
             return;
        }

        // CORRECTION: Choix d'une syllabe aléatória entre as restantes
        silabaAtual = silabasParaJogar[Math.floor(Math.random() * silabasParaJogar.length)].toLowerCase();

        document.getElementById('silaba-maiuscula').textContent = silabaAtual.toUpperCase();

        const optionsDiv = document.getElementById('opcoes-silabas');
        optionsDiv.innerHTML = '';

        const options = [silabaAtual, ...generateDistractors(silabaAtual)];
        options.sort(() => Math.random() - 0.5);

        options.forEach(opt => {
            const btn = document.createElement('button');
            btn.className = 'opcao-btn';
            btn.textContent = opt;
            btn.onclick = () => verificarSilaba(opt);
            optionsDiv.appendChild(btn);
        });
    }

    function verificarSilaba(selection) {
        if (selection === silabaAtual) {
            const key = silabaAtual; // Clé est la syllabe unique
            const currentCount = estadoJogo.syllabesUniquesCompletes[key] || 0;
            estadoJogo.syllabesUniquesCompletes[key] = currentCount + 1;

            const didJustCompleteTwice = estadoJogo.syllabesUniquesCompletes[key] === 2;

            if (didJustCompleteTwice) {
                 adicionarPonto('silaba');
            }

            // Vérification de la progression du word actuel (activation N3)
            const silabasDoMot = getSilabas(palavraAtual);
            const motAtiveN3 = silabasDoMot.every(s => (estadoJogo.syllabesUniquesCompletes[s.toLowerCase()] || 0) >= 2);

            if (motAtiveN3 && !estadoJogo.palavrasAtivasN3[palavraAtual]) {
                estadoJogo.palavrasAtivasN3[palavraAtual] = true; // Active le word pour le N3
                motActuelN2 = '';
                exibirMensagemBravo(() => iniciarNivel2()); // Bravo s'affiche à l'activation N3
            } else {
                iniciarNivel2();
            }

        } else {
            // En cas d'erreur, on relance le niveau 2 immédiatement,
            // la logique de iniciarNivel2 reprendra le même word et une syllabe restante (y compris celle manquée).
            iniciarNivel2();
        }
        salvarEstado();
    }

    // --- NÍVEL 3: PALAVRAS ---

    // New, robust shuffling function (Used for Level 3)
    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]]; // ES6 swap
        }
        return array;
    }

    function generateSimilarWords(correctWord, allWords) {
        const correctLower = correctWord.toLowerCase();
        const correctSyllabeCount = getSilabas(correctWord).length;

        // Filtrer les words qui sont différents du word correct
        let candidates = allWords.filter(w =>
            w !== correctLower
        ).map(w => ({
            word: w,
            syllableCount: getSilabas(w).length
        }));

        // Prioriser les words qui ressemblent (même début, même nombre de syllabes)
        candidates.sort((a, b) =>
            Math.abs(a.syllableCount - correctSyllabeCount) - Math.abs(b.syllableCount - correctSyllabeCount)
        );

        const distractors = [];

        // Choisir deux distractors uniques
        while (distractors.length < 2 && candidates.length > 0) {
            const index = Math.floor(Math.random() * candidates.length);
            const candidate = candidates[index].word;

            // Assurer qu'il ne s'agit pas d'un doublon dans la selection finale
            if (!distractors.includes(candidate)) {
                distractors.push(candidate);
            }
            candidates.splice(index, 1); // Retirer le candidat sélectionné pour éviter la répétition
        }

        // Ajout d'une protection si la liste PALAVRAS est trop courte ou mal formée
        while (distractors.length < 2) {
             // Cria um distrator de backup se necessário
             distractors.push(correctWord.length > 3 ? correctWord.substring(0, correctWord.length-1) + 'o' : 'palavra');
        }

        return distractors.slice(0, 2);
    }

    function iniciarNivel3() {
        // Filtrar les words actifs mais non complétés 2 fois
        const palavrasDisponiveisN3 = PALAVRAS.filter(p => {
            return estadoJogo.palavrasAtivasN3[p] && (estadoJogo.palavrasCompletasN3[p] || 0) < 2;
        });

        if (palavrasDisponiveisN3.length === 0) {
            mostrarTela('home');
            return;
        }

        let palavrasCandidatas = [...palavrasDisponiveisN3];

        // NEW LOGIC: Prevent consecutive repetition unless only one word is available
        if (palavrasCandidatas.length > 1 && palavraAnteriorN3) {
            // Filter out the previously played word
            palavrasCandidatas = palavrasCandidatas.filter(p => p !== palavraAnteriorN3);
            
            // Failsafe: if filtering left us with an empty array (meaning the only other 
            // word was the one we just played, which shouldn't happen if length > 1, 
            // but we use the original list if we somehow filtered everything)
            if (palavrasCandidatas.length === 0) {
                 palavrasCandidatas = [...palavrasDisponiveisN3];
            }
        }

        palavraAtual = palavrasCandidatas[Math.floor(Math.random() * palavrasCandidatas.length)];
        
        // Update the anterior word
        palavraAnteriorN3 = palavraAtual;
        // END NEW LOGIC

        const distractors = generateSimilarWords(palavraAtual, PALAVRAS);
        let options = [palavraAtual, ...distractors];
        
        // SHUFFLE options robustly
        options = shuffleArray(options); 

        const optionsDiv = document.getElementById('opcoes-palavras');
        optionsDiv.innerHTML = '';

        options.forEach(opt => {
            const btn = document.createElement('button');
            btn.className = 'opcao-btn';
            btn.textContent = opt.charAt(0).toUpperCase() + opt.slice(1);
            btn.onclick = () => verificarPalavra(opt);
            optionsDiv.appendChild(btn);
        });

        setTimeout(falarPalavraAtual, 500);
    }

    function falarPalavraAtual() {
        if (palavraAtual) {
            falarTexto(palavraAtual);
        }
    }

    function verificarPalavra(selection) {
        if (selection === palavraAtual) {
            const currentCount = estadoJogo.palavrasCompletasN3[palavraAtual] || 0;
            estadoJogo.palavrasCompletasN3[palavraAtual] = currentCount + 1;

            const didJustCompleteTwice = estadoJogo.palavrasCompletasN3[palavraAtual] === 2;

            if (didJustCompleteTwice) {
                adicionarPonto('palavra');

                const motPhrase = PALAVRAS.find(p => p === palavraAtual);
                if (motPhrase && !estadoJogo.frasesAtivasN4[motPhrase]) {
                    estadoJogo.frasesAtivasN4[motPhrase] = true; // Active la phrase pour le N4
                    exibirMensagemBravo(() => iniciarNivel3());
                } else {
                    exibirMensagemBravo(() => iniciarNivel3());
                }
            } else {
                iniciarNivel3(); // Première réussite: pas de Bravo
            }

        } else {
            iniciarNivel3();
        }
        salvarEstado();
    }

    // --- NÍVEL 4: FRASES (GÉNÉRATION DYNAMIQUE) ---

    let phraseActuelleData = null;

    function iniciarNivel4() {
        // Filtrar les words dont la phrase est activée mais non complétée 2x
        const motsDisponiblesN4 = PALAVRAS.filter(p =>
            estadoJogo.frasesAtivasN4[p] &&
            (estadoJogo.frasesCompletasN4[p] || 0) < 2
        );

        if (motsDisponiveisN4.length === 0) {
            mostrarTela('home');
            return;
        }

        const motChoisi = motsDisponiveisN4[Math.floor(Math.random() * motsDisponiveisN4.length)];
        const defs = getOrGenerateDefinition(motChoisi);

        const estVrai = Math.random() < 0.5;
        const affirmation = estVrai ? defs.verdadeiro : defs.falso;
        const reponseAttendue = estVrai ? 'Verdadeiro' : 'Falso';

        phraseActuelleData = {
            mot: motChoisi,
            affirmation: affirmation,
            reponse_attendue: reponseAttendue
        };

        // FIX: To ensure only the first letter is capitalized (Sentence Case):
        const lowerAffirmation = affirmation.toLowerCase();
        const questionText = lowerAffirmation.charAt(0).toUpperCase() + lowerAffirmation.slice(1);
        
        document.getElementById('frase-pergunta').textContent = questionText;

        // Réinitialiser les couleurs et l'état des boutons avant chaque nouvelle question
        document.querySelectorAll('#tela-nivel-4 .btn-verdadeiro-falso').forEach(btn => {
            btn.classList.remove('feedback-correto', 'feedback-incorreto');
            btn.disabled = false;
        });
    }

    function responderFrase(resposta, elementClicked) {
        if (!phraseActuelleData) return;

        const isCorrect = (resposta === phraseActuelleData.reponse_attendue);

        // 1. Afficher le feedback visuel immédiatement
        elementClicked.classList.add(isCorrect ? 'feedback-correto' : 'feedback-incorreto');

        // 2. Désactiver temporairement les boutons
        document.querySelectorAll('#tela-nivel-4 .btn-verdadeiro-falso').forEach(btn => btn.disabled = true);

        setTimeout(() => {

            if (isCorrect) {
                const currentCount = estadoJogo.frasesCompletasN4[phraseActuelleData.mot] || 0;
                estadoJogo.frasesCompletasN4[phraseActuelleData.mot] = currentCount + 1;

                const didJustCompleteTwice = estadoJogo.frasesCompletasN4[phraseActuelleData.mot] === 2;

                if (didJustCompleteTwice) {
                    adicionarPonto('frase');
                    exibirMensagemBravo(() => iniciarNivel4());
                } else {
                    iniciarNivel4();
                }
            } else {
                iniciarNivel4();
            }
            salvarEstado();

        }, 1500); // Délai de 1.5 secondes pour le feedback
    }

    async function inicializarJogo() {
        await fetchWords();

        // CRITICAL CHECK: Si les words ne sont pas chargés
        if (PALAVRAS.length === 0) {
             document.querySelector('.container').innerHTML =
                "<h1>Erro de Carregamento</h1><p>Não foi possível carregar o arquivo <b>Palavras.txt</b> (ou ele está vazio). O jogo non pode iniciar.</p>";
             return;
        }

        carregarEstado(); // Charger l'état après avoir obtention la liste des words
        atualizarInterfaceHome();
    }

    // --- INITIALISATION ---
    document.addEventListener('DOMContentLoaded', inicializarJogo);
</script>

</body>
</html>
