<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aprendendo com o Pedro (Demo)</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        /* Estilos CSS (style.css incorporé) */
        :root {
            --cor-principal: #3498db; /* BLEU */
            --cor-fundo: #ecf0f1;
            --cor-sucesso: #2ecc71; /* VERT (Succès/Bravo) */
            --cor-erreur: #e74c3c;
            --cor-voltar: #3498db; /* BLEU pour Voltar */
            --cor-reset: #e74c3c;
            --tamanho-letra: 24px;
        }

        body {
            font-family: 'Times New Roman', Times, serif;
            background-color: var(--cor-fundo);
            color: #333;
            margin: 0;
            padding: 20px;
            text-align: center;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            background: #fff;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            position: relative;
        }

        h1, h2 {
            font-family: 'Times New Roman', Times, serif;
            color: var(--cor-principal);
            margin-bottom: 20px;
        }

        /* Seção de Pontuação et Messages */
        #score-container {
            margin-bottom: 20px;
            padding: 10px;
            border: 2px solid var(--cor-principal);
            border-radius: 10px;
        }

        #progresso-msg {
            font-weight: bold;
            color: var(--cor-sucesso);
            margin-top: 10px;
        }

        /* Boutons de Niveau */
        .nivel-btn {
            display: flex;
            align-items: center;
            justify-content: space-between; /* ALIGNEMENT SPÉCIFIQUE POUR POUSSER L'ICÔNE À DROITE */
            width: 100%;
            padding: 15px;
            margin: 10px 0;
            font-size: 1.2em;
            color: #fff;
            background-color: var(--cor-principal);
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: background-color 0.3s;
            font-family: 'Times New Roman', Times, serif;
        }

        .nivel-btn span {
            display: flex; /* Conteneur pour le texte et les icônes */
            align-items: center;
        }

        /* Voltar est BLEU */
        .nivel-btn.voltar-btn {
            background-color: var(--cor-voltar);
            justify-content: center; /* Centrer le contenu du bouton Voltar */
        }

        .nivel-btn.voltar-btn:hover {
            background-color: #2980b9;
        }

        .nivel-btn:hover:not(:disabled) {
            background-color: #2980b9;
        }

        .nivel-btn:disabled {
            background-color: #bdc3c7;
            cursor: not-allowed;
            color: #7f8c8d;
        }

        /* Conteneur pour les icônes à droite du terme */
        .icon-container {
            margin-left: 10px; /* Espace entre le terme et les icônes */
            display: flex;
            align-items: center;
        }
        .icon-container i {
            margin-right: 2px; /* Espacement entre icônes multiples */
            font-size: 1.5em;
        }

        .contador-progresso {
            font-size: 0.8em;
            background: rgba(255, 255, 255, 0.2);
            padding: 2px 8px;
            border-radius: 5px;
            /* Le compteur est naturellement à droite grâce à justify-content: space-between sur .nivel-btn */
        }

        /* Bouton Recomeçar de zero */
        #btn-reset {
            background-color: var(--cor-reset);
            color: white;
            margin-top: 20px;
            padding: 10px;
            font-size: 1em;
            font-family: 'Times New Roman', Times, serif;
            justify-content: center;
        }

        #btn-reset:hover {
            background-color: #c0392b;
        }

        /* Visibilidade des Telas */
        .tela-jogo {
            display: none;
            padding-top: 20px;
        }

        /* Nível 1: Damier */
        #letras-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }

        .letra-quadro {
            height: 80px;
            background-color: #f1c40f;
            color: #333;
            font-size: var(--tamanho-letra);
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            cursor: pointer;
            user-select: none;
            transition: background-color 0.2s, transform 0.1s;
        }

        .letra-quadro.selecionada {
            background-color: #e67e22;
            transform: scale(0.98);
        }

        .letra-quadro.correta {
            background-color: var(--cor-sucesso);
            color: white;
            pointer-events: none;
        }

        .btn-cancelar {
            padding: 10px 20px;
            background-color: var(--cor-erreur);
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        /* Nível 2: Opções de Sílabas (horizontal) */
        #opcoes-silabas {
            display: flex;
            justify-content: space-around;
            gap: 10px;
        }

        /* Styles pour les boutons de réponse dans les niveaux 2, 3 et 4 */
        .opcao-btn, .btn-verdadeiro-falso {
            padding: 15px;
            margin: 10px 0;
            font-size: 1.2em;
            border: 2px solid var(--cor-principal);
            background-color: white;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s;
            font-family: 'Times New Roman', Times, serif;
        }

        /* Feedback Nível 4 */
        .btn-verdadeiro-falso.feedback-correto {
            background-color: var(--cor-sucesso);
            color: white;
            border-color: var(--cor-sucesso);
        }
        .btn-verdadeiro-falso.feedback-incorreto {
            background-color: var(--cor-erreur);
            color: white;
            border-color: var(--cor-erreur);
        }

        /* Nível 3: Options de réponse (plus d'espace) */
        #opcoes-palavras .opcao-btn {
            margin: 15px 0;
        }

        #opcoes-silabas .opcao-btn {
            flex-grow: 1;
            font-size: 1.5em;
        }

        .opcao-btn:hover, .btn-verdadeiro-falso:hover {
            background-color: #eee;
        }

        /* Nível 3: Bouton Escutar (plus petit, aligné) */
        .btn-audio {
            width: auto;
            padding: 10px 20px;
            background-color: var(--cor-principal);
            color: white;
            border: none;
            border-radius: 8px;
            margin: 10px auto 25px auto;
            display: block;
            cursor: pointer;
            font-size: 1.1em;
            font-family: 'Times New Roman', Times, serif;
        }

        .btn-audio i {
            margin: 0;
            font-size: 1.4em;
        }

        /* Message Bravo et Overlay */
        #overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            z-index: 999;
            display: none;
        }

        #mensagem-bravo {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: var(--cor-sucesso);
            color: white;
            padding: 30px 50px;
            border-radius: 20px;
            border: 5px solid white;
            font-size: 2em;
            font-weight: bold;
            z-index: 1000;
            display: none;
            animation: fadeIn 0.3s;
        }

        /* Modal de Confirmação */
        #modal-confirmacao {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            color: #333;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            z-index: 1001;
            width: 80%;
            max-width: 350px;
        }

        #modal-confirmacao p {
            font-size: 1.1em;
            margin-bottom: 20px;
        }

        .botoes-modal {
            display: flex;
            justify-content: space-between;
            gap: 10px;
        }

        .botoes-modal button {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            font-weight: bold;
            cursor: pointer;
            width: 50%;
            font-family: 'Times New Roman', Times, serif;
        }

        #btn-sim {
            background-color: var(--cor-reset);
            color: white;
        }

        #btn-nao {
            background-color: var(--cor-voltar);
            color: white;
        }


        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
    </style>
</head>
<body>

<div id="overlay"></div>

<div id="modal-confirmacao" style="display: none;">
    <p>Você vai perder todos os pontos. Quer mesmo recomeçar?</p>
    <div class="botoes-modal">
        <button id="btn-sim" onclick="confirmaRecomeco()">Sim</button>
        <button id="btn-nao" onclick="cancelaRecomeco()">Não</button>
    </div>
</div>

<div class="container">
    <div id="tela-home" class="tela-jogo" style="display: block;">
        <h1>Oi Pedro ! Vamos estudar !</h1>

        <div id="score-container">
            <p>Pontuação Global: <span id="score-valor">0</span> pontos</p>
            <p id="progresso-msg"></p>
        </div>

        <button class="nivel-btn" id="btn-nivel-1" onclick="iniciarNivel(1)">
            <span class="content-left-group">Letras <span class="icon-container"><i class="fa-solid fa-trophy"></i></span></span>
            <span class="contador-progresso" id="count-n1"></span>
        </button>
        <button class="nivel-btn" id="btn-nivel-2" onclick="iniciarNivel(2)" disabled>
            <span class="content-left-group">Sílabas <span class="icon-container"><i class="fa-solid fa-trophy"></i><i class="fa-solid fa-trophy"></i></span></span>
            <span class="contador-progresso" id="count-n2"></span>
        </button>
        <button class="nivel-btn" id="btn-nivel-3" onclick="iniciarNivel(3)" disabled>
            <span class="content-left-group">Palavras <span class="icon-container"><i class="fa-solid fa-medal"></i></span></span>
            <span class="contador-progresso" id="count-n3"></span>
        </button>
        <button class="nivel-btn" id="btn-nivel-4" onclick="iniciarNivel(4)" disabled>
            <span class="content-left-group">Frases <span class="icon-container"><i class="fa-solid fa-user-graduate"></i></span></span>
            <span class="contador-progresso" id="count-n4"></span>
        </button>

        <button class="nivel-btn" id="btn-reset" onclick="recomecarDeZero()">
            <i class="fa-solid fa-sync-alt"></i> Recomeçar de zero
        </button>
    </div>

    <div id="tela-nivel-1" class="tela-jogo">
        <h2>Letras (Pares)</h2>
        <p>Encontre os 6 pares (Maiúscula e minúscula).</p>
        <div id="letras-grid"></div>
        <button class="btn-cancelar" onclick="cancelarSelecaoNivel1()">Cancelar</button>
        <button class="nivel-btn voltar-btn" onclick="mostrarTela('home')">Voltar</button>
    </div>

    <div id="tela-nivel-2" class="tela-jogo">
        <h2>Sílabas</h2>
        <p>Qual é a sílaba **<span id="silaba-maiuscula" style="color: var(--cor-principal);"></span>** em minúsculas?</p>
        <div id="opcoes-silabas"></div>
        <button class="nivel-btn voltar-btn" onclick="mostrarTela('home')">Voltar</button>
    </div>

    <div id="tela-nivel-3" class="tela-jogo">
        <h2>Palavras</h2>
        <p>Escute a palavra e a encontre entre les options.</p>
        <button class="btn-audio" onclick="falarPalavraAtual()"><i class="fa-solid fa-volume-up"></i></button>
        <div id="opcoes-palavras"></div>
        <button class="nivel-btn voltar-btn" onclick="mostrarTela('home')">Voltar</button>
    </div>

    <div id="tela-nivel-4" class="tela-jogo">
        <h2>Frases</h2>
        <div id="frase-pergunta-container">
            <p id="frase-pergunta" style="font-size: 1.2em; margin: 0;"></p>
        </div>
        <button class="btn-verdadeiro-falso" onclick="responderFrase('Verdadeiro', this)">Verdadeiro</button>
        <button class="btn-verdadeiro-falso" onclick="responderFrase('Falso', this)">Falso</button>
        <button class="nivel-btn voltar-btn" onclick="mostrarTela('home')">Voltar</button>
    </div>

    <div id="mensagem-bravo">Bravo Pedro!</div>

</div>

<script>
    // Configuração das vozes TTS
    const synth = window.speechSynthesis;
    let brazilVoice = null;

    function setupVoice() {
        const voices = synth.getVoices();
        brazilVoice = voices.find(voice => voice.lang === 'pt-BR') || voices[0];
    }

    if (synth.onvoiceschanged !== undefined) {
        synth.onvoiceschanged = setupVoice;
    } else {
        setupVoice();
    }

    function falarTexto(texto) {
        if (synth.speaking) {
            synth.cancel();
        }
        const utterance = new SpeechSynthesisUtterance(texto);
        utterance.lang = 'pt-BR';
        utterance.rate = 0.8;
        if (brazilVoice) {
            utterance.voice = brazilVoice;
        }
        synth.speak(utterance);
    }

    // --- DADOS DU JEU ---

    const DADOS_LETRAS = [
        ['A', 'a', 'E', 'e', 'I', 'i', 'O', 'o', 'U', 'u', 'Y', 'y'],
        ['B', 'b', 'D', 'd', 'P', 'p', 'Q', 'q', 'R', 'r', 'V', 'v'],
        ['C', 'c', 'F', 'f', 'G', 'g', 'H', 'h', 'J', 'j', 'T', 't'],
        ['K', 'k', 'L', 'l', 'M', 'm', 'N', 'n', 'S', 's', 'X', 'x']
    ];

    let PALAVRAS = []; // Sera rempli par fetch

    const DEFINITIONS = {
        'chupeta': {
            verdadeiro: 'Uma chupeta é um objeto que se dá a bebês.',
            falso: 'Uma chupeta é usada para limpar o chão da casa.'
        },
        'carro': {
            verdadeiro: 'Um carro tem quatro rodas e pode levar pessoas para viajar.',
            falso: 'Um carro é um animal perigoso que mora nas árvores.'
        },
        'tomate': {
            verdadeiro: 'O tomate é uma fruta ou legume usado para fazer saladas.',
            falso: 'Um tomate é geralmente de cor azul et a sabor de chocolate.'
        }
    };

    /**
    * Génère une définition Vrai/Faux pour tout mot non couvert par DEFINITIONS.
    */
    function generateDefinition(word) {
        const wordUpper = word.charAt(0).toUpperCase() + word.slice(1);

        const falseObjects = ['peixe', 'planeta', 'caminhão', 'avião', 'gato'];
        const falseLocations = ['lua', 'fundo do mar', 'céu', 'teatro', 'geladeira'];

        const absurdObject = falseObjects[Math.floor(Math.random() * falseObjects.length)];
        const absurdLocation = falseLocations[Math.floor(Math.random() * falseLocations.length)];

        return {
            verdadeiro: `Um(a) ${word} é algo que você pode usar na escola.`,
            falso: `Um(a) ${word} é um tipo de ${absurdObject} que vive na ${absurdLocation}.`
        };
    }

    function getOrGenerateDefinition(word) {
        let defs = DEFINITIONS[word];
        if (!defs) {
             defs = generateDefinition(word);
        }
        return defs;
    }


    function getSilabas(palavra) {
        switch(palavra) {
            case 'chupeta': return ['chu', 'pe', 'ta'];
            case 'carro': return ['car', 'ro'];
            case 'tomate': return ['to', 'ma', 'te'];
            default:
                const regex = /([bcdfghjklmnpqrstvwxyzç]?([aeiouyãõéêáíóú]{1,2}[bcdfghjklmnpqrstvwxyzç]?))/gi;
                const matches = palavra.match(regex) || [palavra];
                return matches.filter(s => s.length >= 2 || (matches.length === 1 && palavra.length >= 2));
        }
    }

    function calcularTotalMaximo() {
        const totalSilabas = PALAVRAS.flatMap(p => getSilabas(p)).length;
        const totalFrases = PALAVRAS.length;
        return 4 + totalSilabas + PALAVRAS.length + totalFrases;
    }

    // Fonction pour charger les mots depuis Palavras.txt (via URL GitHub)
    async function fetchWords() {
        const URL = 'https://regine-lambrecht.github.
